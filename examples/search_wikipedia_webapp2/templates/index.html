{% extends "base.html" %}
{% block title %}Wikipedia全文検索のサンプルアプリ{% endblock %}
{% block content %}
<h1>groongaでWikipedia検索のサンプル</h1>
<p><a href="http://dumps.wikimedia.org/jawiki/20150402/">jawiki dump progress on 20150402</a>のjawiki-20150402-pages-articles1.xml.bz2〜jawiki-20150402-pages-articles4.xml.bz2を取り込んだgroongaのデータベースに対してページタイトルと本文で全文検索するサンプルです。</p>
<div class="search-form">
<form id="searchForm" method="get">
<input type="text" name="q" value="{{ query }}">
<input type="hidden" name="page" value="1">
<input type="hidden" name="limit" value="10">
<input type="submit" value="Search">

<label class="timespan">期間指定:</label>
<select name="timespan">
<option value=""{% if timespan == "" %} selected="selected"{% endif %}>無し</option>
<option value="week"{% if timespan == "week" %} selected="selected"{% endif %}>1週間</option>
<option value="month"{% if timespan == "month" %} selected="selected"{% endif %}>1ヶ月</option>
<option value="year"{% if timespan == "year" %} selected="selected"{% endif %}>1年</option>
</select>
</form>
</div>
{% if hasQueries %}
<div class="results">
<label class="matchedCount">検索結果:</label>
<span>約{{ matchedCount }}件</span>
{% for result in results %}
<div class="result">
<div class="title"><a href="{{ result.URL }}" target="_blank">{{ result.Title }}</a></div>
<div class="updated_at">{{ result.UpdatedAt }}</div>
<div class="content">{{ result.Content }}</div>
</div>
{% endfor %}
</div>
{% if numPages > 1 %}
<div class="pagination">
{%if page > 1 %}
<a class="prevPage" href="{{ url }}&page={{ page - 1 }}">前へ</a>
{% endif %}
{% for p in viewablePages %}
{% if p == page %}
<span class="page">{{ p }}</span>
{% else %}
<a class="page" href="{{ url }}&page={{ p }}">{{ p }}</a>
{% endif %}
{% endfor %}
{%if page < numPages %}
<a class="nextPage" href="{{ url }}&page={{ page + 1 }}">次へ</a>
{% endif %}
</div>
{% endif %}
{% endif %}
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script>
$('select[name=timespan]').on('change', function() {
  $('#searchForm').submit()
})
</script>
{% endblock %}
